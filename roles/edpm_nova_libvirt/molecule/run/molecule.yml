---
driver:
  name: podman
platforms:
  - name: instance
    image: ${EDPM_ANSIBLE_MOLECULE_IMAGE:-"ubi9/ubi-init"}
    registry:
      url: ${EDPM_ANSIBLE_MOLECULE_REGISTRY:-"registry.access.redhat.com"}
    command: /sbin/init
    dockerfile: ../../../../molecule/common/Containerfile.j2
    privileged: true
    ulimits: &ulimit
      - host

provisioner:
  playbooks:
    prepare: "${MOLECULE_SCENARIO_DIRECTORY}/../../resources/molecule/prepare.yml"
    verify: "${MOLECULE_SCENARIO_DIRECTORY}/../../resources/molecule/verify.yml"
    converge: "${MOLECULE_SCENARIO_DIRECTORY}/../../resources/molecule/converge.yml"

scenario:
  name: run
  test_sequence:
    - destroy
    - create
    - prepare
    - converge
    # TODO(bogdando): enable this after edpm container manager tasks
    # become idempotent
    #- idempotence
    - check
    - verify
    - destroy
